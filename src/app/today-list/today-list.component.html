<div class="flex-row-header" style="margin-top:-1px">
  <button *ngIf="!addNew" style="margin-top:10px;margin-right:2em;height:36px" class="circular ui icon button" (click)="new_one()">
      <i class="plus icon"></i>
    </button>
  <div class="ui card" style="width:388px" *ngIf="addNew">
    <div class="content" [formGroup]="form">
      <i class="right floated left icon"></i>
      <label class="ui orange  right ribbon label" style="font-size:100%">新增今日帳單</label>
      <div class="description" style="margin-top: 4px">
        <div class="ui rigth labeled input" style="margin-bottom: 4px; height:33px">
          <input type="text" placeholder="消費者" formControlName="man">
          <a class="ui tag label" id="man">消費者</a>
        </div>
        <div id="dropdown" class="ui dropdown  search icon">
          <i class="user icon"></i>
          <div class="menu" style="max-height: 25em;">
            <div class="ui search icon input" *ngIf="people_diff.length > 9">
              <i class="search icon"></i>
              <input type="text" name="search" placeholder="查詢...">
            </div>
            <div class="item" (click)="select(m)" *ngFor="let m of people_diff">{{m}}</div>
          </div>
        </div>
        <div class="ui rigth labeled input" style="margin-bottom: 4px; height:33px">
          <input type="number" placeholder="消費" style="color:red" formControlName="pay">
          <a class="ui tag label" id="pay" style="color:red">消費</a>
        </div>
        <div class="ui rigth labeled input" style="margin-bottom: 4px; height:33px">
          <input type="number" placeholder="儲值" style="color:green" formControlName="topUp">
          <a class="ui tag label" id="topUp" style="color:green">儲值</a>
        </div>
        <div class="ui rigth labeled input" style="margin-bottom: 4px; height:33px">
          <input type="text" placeholder="店家" formControlName="store">
          <a class="ui tag label" id="store">店家</a>
        </div>
        <div class="ui reply form">
          <div class="field">
            <textarea rows="3" id="content" formControlName="content" placeholder="消費內容"></textarea>
          </div>
        </div>
      </div>
    </div>
    <div class="extra content" style="display:flex;justify-content:space-between">
      <button class="ui labeled icon button" (click)="addNew = false" style="height:33px;padding-top: 9px;">
        <i class="arrow left icon"></i>取消
      </button>
      <button class="ui labeled icon button" style="margin-left: auto;height:33px;padding-top: 9px;" (click)="add()" [ngClass]="{'disabled' : (form.value.topUp + form.value.pay) === 0 || form.value.man === ''}">
        <i class="checkmark icon"></i>確認
      </button>
    </div>
  </div>
</div>
<br>
<div class="ui four cards">
  <div *ngFor="let p of todayArr" class="ui card" style="min-width:345px">
    <div class="content" *ngIf="!p.isedit;else edit_temp">
      <i class="right floated left icon"></i>
      <div class="header">{{p.man}}
      </div>
      <div class="description">
        <span style="color:green">{{"先前儲金:"+p.bcash}}</span>
        <br> {{"店家:"+p.store}}
        <br>
        <span style="color:red">{{"今日消費:"+p.pay}}</span>
        <br>
        <span style="color:green">{{"今日儲值:"+p.topUp}}</span>
        <br> {{"消費內容:"+ p.content}}
        <br><span style="color:gray"> {{"確認後金額:"+ (p.bcash +p.topUp - p.pay)}}</span>
        <br> {{"建立時間:"+(getDateTime(p) )}}
      </div>
    </div>
    <ng-template #edit_temp>
      <div class="content" [formGroup]="form1">
        <i class="right floated left icon"></i>
        <label class="ui orange  right ribbon label" style="font-size:100%">編輯今日帳單</label>
        <div class="description" style="margin-top: 4px">
          <div class="ui right labeled disabled input" style="margin-bottom: 4px; height:30px ">
            <input type="text" placeholder="消費者" formControlName="man">
            <label class="ui tag label">消費者</label>
          </div>
          <div class="ui rigth labeled input" style="margin-bottom: 4px; height:30px">
            <input type="number" id="pay" placeholder="消費" style="color:red" formControlName="pay">
            <label class="ui tag label" for="pay" style="color:red">消費</label>
          </div>
          <div class="ui rigth labeled input" style="margin-bottom: 4px; height:30px">
            <input type="number" id="topUp" placeholder="儲值" style="color:green" formControlName="topUp">
            <label class="ui tag label" for="topUp" style="color:green">儲值</label>
          </div>
          <div class="ui rigth labeled input" style="margin-bottom: 4px; height:30px">
            <input type="text" id="store" placeholder="店家" formControlName="store">
            <label class="ui tag label" for="store">店家</label>
          </div>
          <div class="ui reply form">
            <div class="field">
              <textarea rows="3" id="content" formControlName="content" placeholder="消費內容"></textarea>
            </div>
          </div>
        </div>
      </div>
    </ng-template>
    <div class="extra content flex-row-between" *ngIf="!p.isedit;else edit_button">
      <ng-container *ngIf="!p.ischeck;else edit_check">
        <div id="check" (click)="check(p)">
          <i class="checkmark icon"></i>待確認
        </div>
        <div style="margin-left:1.5em" id="edit" (click)="edit(p?.$key)">
          <i class="icon edit"></i>編輯
        </div>
        <div style="margin-left:auto" id="remove" (click)="remove(p?.$key)">
          <i class="icon remove"></i>刪除
        </div>
      </ng-container>
      <ng-template #edit_check>
        <div id="uncheck" (click)="uncheck(p)" *ngIf="isTimeout">
          <i class="arrow circle left icon"></i>取消
        </div>
        <div style="color:green;margin-left:auto">
          <i class="checkmark icon"></i>確認
        </div>
      </ng-template>
    </div>
    <ng-template #edit_button>
      <div class="extra content" style="display:flex;justify-content:space-between">
        <button class="ui labeled icon button" style="height:30px;padding-top: 8px;" (click)="cancel()">
          <i class="arrow left icon"></i>取消
        </button>
        <button class="ui labeled icon button" style="margin-left: auto;height:30px;padding-top: 8px;" (click)="update(p?.$key)"
          [ngClass]="{'disabled' : (form1.value.topUp + form1.value.pay) === 0}">
          <i class="checkmark icon"></i>確認
        </button>
      </div>
    </ng-template>
  </div>
</div>